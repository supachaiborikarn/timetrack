generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String                 @id @default(cuid())
  employeeId                 String                 @unique
  username                   String?                @unique
  name                       String
  email                      String?                @unique
  phone                      String?                @unique
  pin                        String
  password                   String?
  role                       Role                   @default(EMPLOYEE)
  stationId                  String?
  departmentId               String?
  deviceId                   String?
  photoUrl                   String?
  hourlyRate                 Decimal                @default(0)
  dailyRate                  Decimal                @default(0)
  baseSalary                 Decimal                @default(0)
  otRateMultiplier           Decimal                @default(1.5)
  isActive                   Boolean                @default(true)
  employeeStatus             EmployeeStatus         @default(ACTIVE)
  createdAt                  DateTime               @default(now())
  updatedAt                  DateTime               @updatedAt
  address                    String?
  bankAccountNumber          String?
  bankName                   String?
  birthDate                  DateTime?
  citizenId                  String?
  emergencyContactName       String?
  emergencyContactPhone      String?
  emergencyContactRelation   String?
  gender                     String?
  isSocialSecurityRegistered Boolean                @default(false)
  nickName                   String?
  probationEndDate           DateTime?
  registeredStationId        String?
  socialSecurityNumber       String?
  startDate                  DateTime?              @default(now())
  advances                   Advance[]
  announcements              Announcement[]
  approvedAttendances        Attendance[]           @relation("AttendanceApprover")
  attendances                Attendance[]
  auditLogs                  AuditLog[]
  authenticators             Authenticator[]
  comments                   Comment[]
  dailyPayrollOverrides      DailyPayrollOverride[]
  approvedLeaves             Leave[]                @relation("LeaveApprover")
  leaves                     Leave[]
  notifications              Notification[]
  overtimeRequests           OvertimeRequest[]      @relation("OvertimeRequests")
  payrollRecords             PayrollRecord[]
  profileEditRequests        ProfileEditRequest[]
  pushSubscriptions          PushSubscription[]
  reviewSubmissions          ReviewSubmission[]
  shiftAssignments           ShiftAssignment[]
  swapRequestsSent           ShiftSwap[]            @relation("SwapRequester")
  swapRequestsReceived       ShiftSwap[]            @relation("SwapTarget")
  specialIncomes             SpecialIncome[]
  timeCorrections            TimeCorrection[]
  department                 Department?            @relation(fields: [departmentId], references: [id])
  registeredStation          Station?               @relation("RegisteredStation", fields: [registeredStationId], references: [id])
  station                    Station?               @relation("WorkStation", fields: [stationId], references: [id])

  @@index([stationId])
  @@index([departmentId])
}

model Authenticator {
  credentialID         String  @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?
  user                 User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, credentialID])
}

model Announcement {
  id        String    @id @default(cuid())
  title     String
  content   String
  authorId  String
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  author    User      @relation(fields: [authorId], references: [id])
  comments  Comment[]

  @@index([createdAt])
}

model Comment {
  id        String       @id @default(cuid())
  content   String
  postId    String
  authorId  String
  createdAt DateTime     @default(now())
  author    User         @relation(fields: [authorId], references: [id])
  post      Announcement @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model ReviewPeriod {
  id          String             @id @default(cuid())
  title       String
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  submissions ReviewSubmission[]
}

model ReviewSubmission {
  id            String       @id @default(cuid())
  employeeId    String
  periodId      String
  selfReview    String
  managerReview String?
  rating        Int?
  status        String       @default("DRAFT")
  submittedAt   DateTime?
  completedAt   DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  employee      User         @relation(fields: [employeeId], references: [id])
  period        ReviewPeriod @relation(fields: [periodId], references: [id])

  @@unique([employeeId, periodId])
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String?
  details   String?
  ipAddress String?
  userAgent String?
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
}

model PushSubscription {
  id        String   @id @default(cuid())
  endpoint  String   @unique
  p256dh    String
  auth      String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model ShiftTemplate {
  id          String   @id @default(cuid())
  name        String
  description String?
  shifts      Json
  stationId   String?
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([stationId])
}

model LeaveBalance {
  id            String   @id @default(cuid())
  userId        String
  year          Int
  sickLeave     Int      @default(30)
  annualLeave   Int      @default(6)
  personalLeave Int      @default(3)
  usedSick      Int      @default(0)
  usedAnnual    Int      @default(0)
  usedPersonal  Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, year])
  @@index([userId])
}

model OvertimeRequest {
  id           String    @id @default(cuid())
  userId       String
  date         DateTime
  hours        Decimal
  reason       String
  status       String    @default("PENDING")
  approvedById String?
  approvedAt   DateTime?
  rejectReason String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation("OvertimeRequests", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Station {
  id                  String       @id @default(cuid())
  name                String
  code                String       @unique
  type                StationType
  address             String
  latitude            Decimal
  longitude           Decimal
  radius              Int          @default(100)
  wifiSSID            String?
  qrCode              String?
  isActive            Boolean      @default(true)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  departments         Department[]
  shifts              Shift[]
  registeredEmployees User[]       @relation("RegisteredStation")
  employees           User[]       @relation("WorkStation")

  @@index([code])
}

model Department {
  id            String            @id @default(cuid())
  name          String
  code          String
  stationId     String
  isFrontYard   Boolean           @default(false)
  weeklyDayOff  Int?
  sundayEndTime String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  station       Station           @relation(fields: [stationId], references: [id])
  allowedShifts DepartmentShift[]
  employees     User[]

  @@unique([stationId, code])
  @@index([stationId])
}

model Shift {
  id           String            @id @default(cuid())
  code         String            @unique
  name         String
  startTime    String
  endTime      String
  stationId    String?
  breakMinutes Int               @default(60)
  isNightShift Boolean           @default(false)
  isActive     Boolean           @default(true)
  sortOrder    Int               @default(0)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  departments  DepartmentShift[]
  station      Station?          @relation(fields: [stationId], references: [id])
  assignments  ShiftAssignment[]

  @@index([stationId])
  @@index([code])
}

model DepartmentShift {
  id           String     @id @default(cuid())
  departmentId String
  shiftId      String
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  shift        Shift      @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@unique([departmentId, shiftId])
}

model ShiftPattern {
  id           String   @id @default(cuid())
  name         String
  departmentId String?
  month        Int
  year         Int
  isActive     Boolean  @default(true)
  patternData  String   @default("")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([departmentId, month, year])
}

model ShiftAssignment {
  id        String   @id @default(cuid())
  userId    String
  shiftId   String
  date      DateTime
  isDayOff  Boolean  @default(false)
  createdAt DateTime @default(now())
  shift     Shift    @relation(fields: [shiftId], references: [id])
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([date])
  @@index([shiftId])
}

model Attendance {
  id                 String           @id @default(cuid())
  userId             String
  date               DateTime
  checkInTime        DateTime?
  checkInLat         Decimal?
  checkInLng         Decimal?
  checkInDeviceId    String?
  checkInMethod      String?
  checkOutTime       DateTime?
  checkOutLat        Decimal?
  checkOutLng        Decimal?
  checkOutDeviceId   String?
  checkOutMethod     String?
  status             AttendanceStatus @default(PENDING)
  actualHours        Decimal?
  overtimeHours      Decimal?
  lateMinutes        Int?
  earlyLeaveMinutes  Int?
  latePenaltyAmount  Decimal          @default(0)
  note               String?
  approvedBy         String?
  approvedAt         DateTime?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  breakDurationMin   Int?
  breakEndTime       DateTime?
  breakPenaltyAmount Decimal          @default(0)
  breakStartTime     DateTime?
  approver           User?            @relation("AttendanceApprover", fields: [approvedBy], references: [id])
  user               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([date])
  @@index([status])
}

model Leave {
  id         String      @id @default(cuid())
  userId     String
  type       LeaveType
  startDate  DateTime
  endDate    DateTime
  reason     String?
  status     LeaveStatus @default(PENDING)
  approvedBy String?
  approvedAt DateTime?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  approver   User?       @relation("LeaveApprover", fields: [approvedBy], references: [id])
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, startDate])
  @@index([status])
}

model PayrollPeriod {
  id        String          @id @default(cuid())
  name      String
  startDate DateTime
  endDate   DateTime
  payDate   DateTime
  status    PayrollStatus   @default(DRAFT)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  records   PayrollRecord[]

  @@index([startDate, endDate])
}

model PayrollRecord {
  id            String        @id @default(cuid())
  periodId      String
  userId        String
  workDays      Int
  totalHours    Decimal
  overtimeHours Decimal
  basePay       Decimal
  overtimePay   Decimal
  latePenalty   Decimal       @default(0)
  advanceDeduct Decimal       @default(0)
  otherDeduct   Decimal       @default(0)
  netPay        Decimal
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  period        PayrollPeriod @relation(fields: [periodId], references: [id])
  user          User          @relation(fields: [userId], references: [id])

  @@unique([periodId, userId])
  @@index([userId])
}

model Advance {
  id         String        @id @default(cuid())
  userId     String
  amount     Decimal
  date       DateTime
  reason     String?
  status     AdvanceStatus @default(PENDING)
  approvedBy String?
  approvedAt DateTime?
  paidAt     DateTime?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  month      Int?
  note       String?
  year       Int?
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([status])
  @@index([month, year])
}

model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TimeCorrection {
  id               String        @id @default(cuid())
  userId           String
  date             DateTime
  requestType      String
  requestedTime    DateTime
  reason           String
  originalCheckIn  DateTime?
  originalCheckOut DateTime?
  status           RequestStatus @default(PENDING)
  approvedBy       String?
  approvedAt       DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([status])
}

model ShiftSwap {
  id             String        @id @default(cuid())
  requesterId    String
  targetId       String
  requesterDate  DateTime
  targetDate     DateTime
  reason         String?
  status         RequestStatus @default(PENDING)
  targetAccepted Boolean       @default(false)
  approvedBy     String?
  approvedAt     DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  requester      User          @relation("SwapRequester", fields: [requesterId], references: [id])
  target         User          @relation("SwapTarget", fields: [targetId], references: [id])

  @@index([requesterId])
  @@index([targetId])
  @@index([status])
}

model ShiftPool {
  id          String          @id @default(cuid())
  shiftId     String
  date        DateTime
  releasedBy  String
  claimedBy   String?
  reason      String?
  status      ShiftPoolStatus @default(OPEN)
  bonusAmount Decimal?
  claimedAt   DateTime?
  expiredAt   DateTime?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([status])
  @@index([date])
  @@index([releasedBy])
}

model EmployeeAvailability {
  id        String             @id @default(cuid())
  userId    String
  date      DateTime
  status    AvailabilityStatus @default(AVAILABLE)
  note      String?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  @@unique([userId, date])
  @@index([date])
  @@index([userId])
}

model Permission {
  id              String           @id @default(cuid())
  code            String           @unique
  name            String
  group           String
  description     String?
  sortOrder       Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rolePermissions RolePermission[]

  @@index([group])
}

model RolePermission {
  id           String     @id @default(cuid())
  role         Role
  permissionId String
  createdAt    DateTime   @default(now())
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([role, permissionId])
  @@index([role])
}

model ProfileEditRequest {
  id           String    @id @default(cuid())
  userId       String
  fieldName    String
  fieldLabel   String
  oldValue     String?
  newValue     String
  status       String    @default("PENDING")
  createdAt    DateTime  @default(now())
  reviewedAt   DateTime?
  reviewedBy   String?
  rejectReason String?
  user         User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
}

model DailyPayrollOverride {
  id                String   @id @default(cuid())
  userId            String
  date              DateTime
  overrideDailyWage Decimal?
  overrideOT        Decimal?
  note              String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@index([createdAt])
}

model SpecialIncome {
  id          String    @id @default(cuid())
  userId      String
  date        DateTime
  shiftId     String?
  stationId   String?
  type        String
  description String?
  salesAmount Decimal?
  percentage  Decimal?
  amount      Decimal
  status      String    @default("PENDING")
  approvedBy  String?
  approvedAt  DateTime?
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([stationId, date])
  @@index([status])
}

enum Role {
  ADMIN
  HR
  MANAGER
  CASHIER
  EMPLOYEE
}

enum EmployeeStatus {
  ACTIVE
  RESIGNED
  SUSPENDED
}

enum StationType {
  GAS_STATION
  COFFEE_SHOP
}

enum AttendanceStatus {
  PENDING
  APPROVED
  REJECTED
  ABSENT
  LEAVE
}

enum LeaveType {
  SICK
  PERSONAL
  VACATION
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PayrollStatus {
  DRAFT
  PROCESSING
  FINALIZED
}

enum AdvanceStatus {
  PENDING
  APPROVED
  PAID
  REJECTED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ShiftPoolStatus {
  OPEN
  CLAIMED
  EXPIRED
  CANCELLED
}

enum AvailabilityStatus {
  AVAILABLE
  UNAVAILABLE
  PREFERRED_OFF
}
